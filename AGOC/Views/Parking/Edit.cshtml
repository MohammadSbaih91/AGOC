@model AGOC.ViewModels.ParkingViewModels

@{
    ViewData["Title"] = "تعديل سجل وقوف المركبات";
}

<div class="container mt-4">
    <h2 class="text-center mb-4">تعديل سجل وقوف المركبات</h2>
    @if (ViewData["ErrorMessage"] != null)
    {
        <div class="alert alert-danger">
            @ViewData["ErrorMessage"]
        </div>
    }
    <form id="parkingEditForm" asp-action="Edit" method="post">
        <input type="hidden" asp-for="Id" />

        <div class="row mb-3">
            @* <div class="col-md-6">
            <div class="form-group">
            <label for="LicensePlateNumber">رقم المركبة</label>
            <input type="text" id="LicensePlateNumber" class="form-control" name="LicensePlateNumber" value="@Model.LicensePlateNumber" />
            <span id="LicensePlateNumberError" class="text-danger"></span>
            </div>
            </div> *@
            <div class="col-md-6">
                <div class="form-group">
                    <label for="EmployeeCode">رقم الموظف</label>
                    <input type="text" id="EmployeeCode" class="form-control" name="EmployeeCode" value="@Model.EmployeeCode" />
                    <span id="EmployeeCodeError" class="text-danger"></span>
                </div>
            </div>
            <div class="col-md-6">
                <div class="form-group">
                    <label for="ParkingSpotNumber">رقم موقف السيارة</label>
                    <input type="text" id="ParkingSpotNumber" class="form-control" name="ParkingSpotNumber" value="@Model.ParkingSpotNumber" />
                    <span id="ParkingSpotNumberError" class="text-danger"></span>
                </div>
            </div>
        </div>

        <div class="row mb-3">
            <div class="col-md-6">
                <div class="form-group">
                    <label for="Date">التاريخ</label>
                    <input type="date" id="Date" class="form-control" name="Date" value="@Model.Date?.ToString("yyyy-MM-dd")" />
                    <span id="DateError" class="text-danger"></span>
                </div>
            </div>
        </div>

        <div class="form-group text-center">
            <input type="submit" value="حفظ" class="btn btn-primary" />
            <a href="@Url.Action("Index")" class="btn btn-secondary">العودة إلى القائمة</a>
        </div>
    </form>
</div>

<script>
    $(document).ready(function () {
        $(".close").click(function () {
            $('#confirmationModal').modal('hide');
        });
        $('#parkingEditForm').on('submit', function (event) {
            event.preventDefault(); // Prevent form submission for now

            // Clear previous errors
            // $('#LicensePlateNumberError').text('');
            $('#EmployeeCodeError').text('');
            $('#ParkingSpotNumberError').text('');
            $('#DateError').text('');

            let isValid = true;

            // // Validate LicensePlateNumber
            // const licensePlateNumber = $('#LicensePlateNumber').val();
            // if (!licensePlateNumber) {
            //     $('#LicensePlateNumberError').text('رقم المركبة مطلوب.');
            //     isValid = false;
            // }

            // Validate EmployeeCode
            const employeeCode = $('#EmployeeCode').val();
            if (!employeeCode) {
                $('#EmployeeCodeError').text('رقم الموظف مطلوب.');
                isValid = false;
            }

            // Validate ParkingSpotNumber
            const parkingSpotNumber = $('#ParkingSpotNumber').val();
            if (!parkingSpotNumber) {
                $('#ParkingSpotNumberError').text('رقم موقف السيارة مطلوب.');
                isValid = false;
            }

            // Validate Date
            const date = $('#Date').val();
            if (!date) {
                $('#DateError').text('التاريخ مطلوب.');
                isValid = false;
            }

            // If the form is valid, show the confirmation modal
            if (isValid) {
                const confirmationMessage = `هل انت متأكد من تخصيص الموقف رقم ${parkingSpotNumber} للموظف رقم ${employeeCode}؟`;
                $('#confirmationMessage').text(confirmationMessage);
                $('#confirmationModal').modal('show'); // Show the modal
            }
        });

        // Handle the confirm button click in the modal
        $('#confirmButton').on('click', function () {
            $('#parkingEditForm').off('submit').submit(); // Allow form submission after confirmation
        });
    });
</script>


<!-- Confirmation Modal -->
<div class="modal fade" id="confirmationModal" tabindex="-1" role="dialog" aria-labelledby="confirmationModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header d-flex justify-content-between align-items-center">
                <h5 class="modal-title" id="confirmationModalLabel">تأكيد التخصيص الموقف</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <!-- The confirmation message will be dynamically inserted here -->
                <p id="confirmationMessage"></p>
            </div>
            <div class="modal-footer">
                <button type="button" id="confirmButton" class="btn btn-primary">نعم</button>
                <button type="button" class="btn btn-secondary close" data-dismiss="modal">لا</button>
            </div>
        </div>
    </div>
</div>